/* KickStart 0.5 (c) http://w2ui.com/kickstart, vitmalina@gmail.com */
var app={};app.header=function(e){$("#app-header").html(e)},app.load=function(e,t,n){if(typeof app.core.modules[e]=="undefined"){console.log('ERROR: module "'+e+'" is not defined. Define it in app/conf/modules.js.');return}t||(t={}),app[e]=app[e]||{},app[e].params=$.extend({},t),app.core.modules[e]&&app.core.modules[e].isLoaded===!0?typeof app[e].render=="undefined"?$.error('Loader: module "'+e+'" has no render() method.'):(app[e].render(),typeof n=="function"&&n(!0)):app.ajax({url:app.core.modules[e].url,dataType:"script",success:function(t,r,i){app.core.modules[e].isLoaded=!0,typeof n=="function"&&n(!0)},error:function(t,r,i){r=="error"?$.error('Loader: module "'+e+'" failed to load ('+app.core.modules[e].url+")."):($.error('Loader: module "'+e+'" is loaded ('+app.core.modules[e].url+"), but with a parsing error(s) in line "+i.line+": "+i.message),app.core.modules[e].isLoaded=!0,typeof n=="function"&&n(!1))}})},app.get=function(e,t){function s(){r--,r<=0&&t(n)}var n={},r=e.length;for(var i in e)(function(){var t=i,r=e[i];app.ajax({url:r,dataType:"text",success:function(e,i,o){if(i!="success"){$.error("Loader: error while getting a file "+r+".");return}n[t]=o.responseText,s()},error:function(r,o,u){o=="error"?$.error("Loader: failed to load "+e[i]+"."):($.error('Loader: file "'+e[i]+'" is loaded, but with a parsing error(s) in line '+u.line+": "+u.message),n[t]=responseObj.responseText,s())}})})()},app.include=function(e){typeof e=="string"&&(e=[e]);for(var t in e)$(document).append('<script type="text/javascript" src="'+e[t]+'"></script>')},app.ajax=function(e,t){typeof t=="undefined"?t=e:$.extend(t,{url:e}),typeof t.error!="undefined"&&(t._error_=t.error),t.error=function(e,n,r){typeof app.ajaxError=="function"&&app.ajaxError(e,n,r),typeof t._error_=="function"&&t._error_(e,n,r)},t.cache=!1,$.ajax(t)},app.error=function(e,t,n){typeof n=="undefined"&&typeof t=="function"&&(n=t,t="Error"),typeof t=="undefined"&&(t="Error");if($("#w2ui-popup").length>0){$("#w2ui-popup .w2ui-popup-message").remove(),$().w2popup("message",{width:500,height:200,showMax:!1,html:'<div class="centered"><div style="padding-bottom: 30px">	<div style=\'display: inline-block; text-align: left; font-size: 12px; font-family: Monaco, "Courier New"; color: #555;\'>'+String(e).replace(/\n/g,"<br>")+"	</div>"+"</div></div>"}),$("#w2ui-popup .w2ui-popup-message").on("click",function(e){typeof n=="function"&&n()});return}$().w2popup("open",{width:500,height:245,showMax:!1,title:typeof t!="undefined"?t:"Error",body:'<div class="centered"><div>  <div style=\'display: inline-block; text-align: left; font-size: 12px; font-family: Monaco, "Courier New"; color: #555;\'>'+String(e).replace(/\n/g,"<br>")+"	 </div>"+"</div></div>",buttons:'<input type="button" value="Ok" onclick="$().w2popup(\'close\')" style="width: 60px">',onClose:function(){typeof n=="function"&&n()}})},app.alert=function(e,t,n){typeof n=="undefined"&&typeof t=="function"&&(n=t,t="Notification"),typeof t=="undefined"&&(t="Notification"),$().w2popup({width:500,height:245,title:t,body:'<div class="centered"><div>'+e+"</div></div>",buttons:'<input type="button" value="Ok" style="width: 60px" onclick="$().w2popup(\'close\');">',onClose:function(){typeof n=="function"&&n()}})},app.confirm=function(e,t,n){if(typeof n=="undefined"||typeof t=="function")n=t,t="Confirmation";typeof t=="undefined"&&(t="Confirmation"),$().w2popup({width:500,height:245,title:t,showClose:!1,modal:!0,body:'<div class="centered"><div>'+e+"</div></div>",buttons:'<input class="btn" type="button" value="No" style="width: 60px; margin-right: 5px">&nbsp;<input class="btn" type="button" value="Yes" style="width: 60px">'}),$("#w2ui-popup .btn").on("click",function(e){$().w2popup("close"),typeof n=="function"&&n(this.value),e.stopPropagation()})},app.core=function(obj){function init(){if(document.location.href.indexOf("login.html")>0)app.get(["app/conf/utils.js"],function(data){try{for(var i in data)eval(data[i])}catch(e){}});else{var files=["app/conf/action.js","app/conf/config.js","app/conf/modules.js","app/conf/utils.js","app/conf/start.js"];app.get(files,function(data){try{for(var i in data)eval(data[i])}catch(e){app.include(files)}app.core.config=config,app.core.modules=modules,$("#app-toolbar").w2toolbar(config.app_toolbar),$("#app-tabs").w2tabs(config.app_tabs),$("#app-main").w2layout(config.app_layout),setTimeout(popin,100)})}}function popin(){$("#app-container").fadeIn(200),setTimeout(function(){var e=0;config.show.toolbar?($("#app-toolbar").css("height","30px").show(),e+=30):$("#app-toolbar").hide(),config.show.tabs?($("#app-tabs").css({top:e+"px",height:"30px"}).show(),e+=30):$("#app-tabs").hide(),$("#app-top").css("height",e+"px").show(),config.show.header?($("#app-header").css({top:e+"px",height:"60px"}).show(),e+=60):$("#app-header").hide(),$("#app-main").css("top",e+"px"),typeof app.start=="function"&&app.start();var t=String(document.location.hash);t.length>1&&(t=t.substr(1)),$.trim(t)!=""&&app.route.go(t)},200)}var action,config,modules,start;return obj.user={},obj.modules=modules,init(),obj}(app.core||{}),app.route=function(e){function n(){$(window).on("hashchange",function(e){if(t===!0)return;var n=String(document.location.hash).replace(/\/{2,}/g,"/");n.length>1&&(n=n.substr(1)),app.route.go(n)})}function r(e){e.substr(0,1)!="/"&&(e="/"+e),t=!0,document.location.hash=e,setTimeout(function(){t=!1},1)}function i(){var e=String(document.location.hash).replace(/\/{2,}/g,"/");return e.length>1&&(e=e.substr(1)),e.length>1&&e.substr(0,1)=="/"&&(e=e.substr(1)),e.split("/")}function s(e){if(!e)return;e.substr(0,1)!="/"&&(e="/"+e),e=e.replace(/\/{2,}/g,"/");var t=app.route.parse(),n=t[0];app.route.set(e),app.core.modules[n]&&app.core.modules[n].isLoaded?(app[n].params={route:e,parsed:app.route.parse()},app[n].render()):app.load(n,{route:e,parsed:app.route.parse()})}var t=!1;return e.set=r,e.parse=i,e.go=s,n(),e}(app.route||{});
