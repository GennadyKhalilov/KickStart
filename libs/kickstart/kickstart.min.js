/* kicstart 0.x (c) http://w2ui.com/kickstart, vitmalina@gmail.com */
var app={};app.header=function(e){$("#app-header").html(e)},app.timer=function(){app._timer_start=(new Date).getTime(),app._timer_lap=(new Date).getTime(),console.log("Start Timer")},app.lap=function(e){typeof e!="string"?e="":e=' "'+e+'"',console.log("Total:",(new Date).getTime()-app._timer_start,"Lap"+e+":",(new Date).getTime()-app._timer_lap),app._timer_lap=(new Date).getTime()},app.load=function(e,t,n){function o(){typeof n=="function"&&r==0&&n(!0)}$.isArray(e)||(e=[e]),typeof t=="function"&&(n=t,t={}),t||(t={});var r=e.length;for(var i in e){var s=e[i];if(typeof app.core.modules[s]=="undefined"){r--,console.log('ERROR: module "'+s+'" is not defined. Define it in app/conf/modules.js.');return}app[s]=app[s]||{},app[s].params=$.extend({},t),app.core.modules[s]&&app.core.modules[s].isLoaded===!0?(r--,typeof app[s].render=="undefined"?console.log('ERROR: Loader: module "'+s+'" has no render() method.'):(app[s].render(),o())):$.ajax({url:app.core.modules[s].url,dataType:"script"}).always(function(){r--}).done(function(e,t,n){app.core.modules[s].isLoaded=!0,o()}).fail(function(e,t,n){t=="error"?console.log('ERROR: Loader: module "'+s+'" failed to load ('+app.core.modules[s].url+")."):(console.log('ERROR: Loader: module "'+s+'" is loaded ('+app.core.modules[s].url+"), but with a parsing error(s) in line "+n.line+": "+n.message),app.core.modules[s].isLoaded=!0,o())})}},app.get=function(e,t){function s(){r--,r<=0&&t(n)}var n={},r=e.length;for(var i in e)(function(){var t=i,r=e[i];$.ajax({url:r,dataType:"text",success:function(e,i,o){if(i!="success"){console.log("ERROR: Loader: error while getting a file "+r+".");return}n[t]=o.responseText,s()},error:function(r,o,u){o=="error"?console.log("ERROR: Loader: failed to load "+e[i]+"."):(console.log('ERROR: Loader: file "'+e[i]+'" is loaded, but with a parsing error(s) in line '+u.line+": "+u.message),n[t]=responseObj.responseText,s())}})})()},app.include=function(e){typeof e=="string"&&(e=[e]);for(var t in e)$(document).append('<script type="text/javascript" src="'+e[t]+'"></script>')},app.core=function(obj){function init(){app.get(["app/conf/session.js"],function(data){try{for(var i in data)eval(data[i])}catch(e){}if(document.location.href.indexOf("login.html")>0)return;app.core.user=app.session();if($.isEmptyObject(app.core.user)){document.location="login.html";return}var files=["app/conf/action.js","app/conf/modules.js","app/conf/config.js","app/conf/start.js"];app.get(files,function(data){try{for(var i in data)eval(data[i])}catch(e){app.include(files)}app.core.config=config,app.core.modules=modules,$("#app-toolbar").w2toolbar(app.core.config.app_toolbar),$("#app-tabs").w2tabs(app.core.config.app_tabs),$("#app-main").w2layout(app.core.config.app_layout),setTimeout(popin,100)})})}function popin(){$("#app-container").fadeIn(200),setTimeout(function(){var e=0;app.core.config.show.toolbar?($("#app-toolbar").css("height","30px").show(),e+=30):$("#app-toolbar").hide(),app.core.config.show.tabs?($("#app-tabs").css({top:e+"px",height:"30px"}).show(),e+=30):$("#app-tabs").hide(),$("#app-top").css("height",e+"px").show(),app.core.config.show.header?($("#app-header").css({top:e+"px",height:"60px"}).show(),e+=60):$("#app-header").hide(),$("#app-main").css("top",e+"px"),typeof app.start=="function"&&app.start();var t=String(document.location.hash);t.length>1&&(t=t.substr(1)),$.trim(t)!=""&&app.route.go(t)},200)}var config,modules;return obj.user={},obj.modules=modules,init(),obj}(app.core||{}),app.route=function(e){function n(){$(window).on("hashchange",function(e){if(t===!0)return;var n=String(document.location.hash).replace(/\/{2,}/g,"/");n.length>1&&(n=n.substr(1)),app.route.go(n)})}function r(e){e.substr(0,1)!="/"&&(e="/"+e),t=!0,document.location.hash=e,setTimeout(function(){t=!1},1)}function i(){var e=String(document.location.hash).replace(/\/{2,}/g,"/");return e.length>1&&(e=e.substr(1)),e.length>1&&e.substr(0,1)=="/"&&(e=e.substr(1)),e.split("/")}function s(e){if(!e)return;e.substr(0,1)!="/"&&(e="/"+e),e=e.replace(/\/{2,}/g,"/");var t=app.route.parse(),n=t[0];app.route.set(e),app.core.modules[n]&&app.core.modules[n].isLoaded?(app[n].params={route:e,parsed:app.route.parse()},app[n].render()):app.load(n,{route:e,parsed:app.route.parse()})}var t=!1;return e.set=r,e.parse=i,e.go=s,n(),e}(app.route||{});
